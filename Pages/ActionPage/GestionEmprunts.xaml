<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="BibliothequeManager.Pages.ActionPage.GestionEmprunts"
             xmlns:localApp="clr-namespace:BibliothequeManager"
             NavigationPage.HasNavigationBar="False"
             Title="Gestion des Emprunts">
    <Grid>
        <!-- Fond avec dÃ©gradÃ© -->
        <Image Source="new_background.png"
           Aspect="AspectFill"
           InputTransparent="True"
           Opacity="0.2" />

        <ScrollView>
            <Grid RowDefinitions="Auto, Auto, *">
                <!-- En-tÃªte -->
                <Grid Style="{StaticResource StackLayoutAcc}">
                    <StackLayout Orientation="Horizontal" HorizontalOptions="Center" Spacing="100">
                        <!-- Logo Ã  gauche -->
                        <Border Style="{StaticResource RoundedImageBorder}">
                            <Image Source="logo.png" Style="{StaticResource Logo}" />
                        </Border>

                        <StackLayout Style="{StaticResource StackLayoutAcce}">
                            <Label Text="{Binding [LoanManagement], Source={x:Static localApp:App.Localized}}"
                           Style="{StaticResource HeaderLabel}"/>
                            <Label Text="Suivi complet des emprunts en cours et historiques" 
                           Style="{StaticResource SubHeaderLabel}"/>
                        </StackLayout>
                    </StackLayout>
                </Grid>
                <!-- Barre d'outils et statistiques -->
                <Border Grid.Row="1" 
                       Style="{StaticResource ModernCard}">
                    <StackLayout Spacing="15">
                        <!-- Barre de recherche et filtres -->
                        <Grid ColumnDefinitions="auto,*, auto" 
                              ColumnSpacing="10" 
                              Padding="10,0">
                            <Button Grid.Column="0" 
                                    Text="ğŸ  Accueil" 
                                    Style="{StaticResource GradientButtonSecondary}"
                                    Clicked="OnAccueilClicked"/>
                            <Entry x:Name="SearchEntry"
                                    Placeholder="ğŸ” Rechercher par titre, auteur, adhÃ©rent..."
                                    Style="{StaticResource ModernEntry}"
                                    Grid.Column="1"/>

                            <Picker x:Name="FilterPicker"
                                    Title="Filtrer par statut"
                                    Style="{StaticResource ModernPicker}"
                                    Grid.Column="2"
                                    WidthRequest="150">
                                <Picker.ItemsSource>
                                    <x:Array Type="{x:Type x:String}">
                                        <x:String>Tous les emprunts</x:String>
                                        <x:String>En cours</x:String>
                                        <x:String>En retard</x:String>
                                        <x:String>RetournÃ©s</x:String>
                                    </x:Array>
                                </Picker.ItemsSource>
                            </Picker>
                        </Grid>

                        <!-- Statistiques rapides -->
                        <Border Style="{StaticResource BorderLivreSelectionne}"
                                Margin="10">
                            <Grid ColumnDefinitions="*, *, *, *" 
                                  ColumnSpacing="10"
                                  Padding="15">

                                <StackLayout Grid.Column="0" Spacing="5" HorizontalOptions="Center">
                                    <Label Text="{Binding TotalEmprunts}" 
                                           FontFamily="PlaypenSansBold"
                                           FontSize="20"
                                           TextColor="#1E293B"
                                           HorizontalOptions="Center"/>
                                    <Label Text="Total" 
                                            Style="{StaticResource LabelEmprunt}"/>
                                </StackLayout>

                                <StackLayout Grid.Column="1" Spacing="5" HorizontalOptions="Center">
                                    <Label Text="{Binding EmpruntsEnCours}" 
                                   FontFamily="PlaypenSansBold"
                                   FontSize="20"
                                   TextColor="#10B981"
                                   HorizontalOptions="Center"/>
                                    <Label Text="En cours" 
                                            Style="{StaticResource LabelEmprunt}"/>
                                </StackLayout>

                                <StackLayout Grid.Column="2" Spacing="5" HorizontalOptions="Center">
                                    <Label Text="{Binding EmpruntsEnRetard}" 
                                           FontFamily="PlaypenSansBold"
                                           FontSize="20"
                                           TextColor="#EF4444"
                                           HorizontalOptions="Center"/>
                                    <Label Text="En retard" 
                                            Style="{StaticResource LabelEmprunt}"/>
                                </StackLayout>

                                <StackLayout Grid.Column="3" Spacing="5" HorizontalOptions="Center">
                                    <Label Text="{Binding EmpruntsRetournes}" 
                                           FontFamily="PlaypenSansBold"
                                           FontSize="20"
                                           TextColor="#3B82F6"
                                           HorizontalOptions="Center"/>
                                    <Label Text="RetournÃ©s" 
                                            Style="{StaticResource LabelEmprunt}"/>
                                </StackLayout>
                            </Grid>
                        </Border>
                    </StackLayout>
                </Border>

                <!-- Liste des emprunts -->
                <Border Grid.Row="2" 
                       Style="{StaticResource ModernCard}" >
                    <Grid RowDefinitions="Auto, *">

                        <!-- En-tÃªte du tableau -->
                        <Border Grid.Row="0" 
                                BackgroundColor="#F1F5F9"
                                Padding="15,12">
                            <Grid ColumnDefinitions="1.5*,1.2*,1*,1*,1*,1*,0.8*,1*"
                          ColumnSpacing="10">
                                <Label Text="Livre et AdhÃ©rent" Style="{StaticResource TableHeader}" />
                                <Label Text="ISBN" Style="{StaticResource TableHeader}" Grid.Column="1"/>
                                <Label Text="Date Emprunt" Style="{StaticResource TableHeader}" Grid.Column="2"/>
                                <Label Text="Date Retour" Style="{StaticResource TableHeader}" Grid.Column="3"/>
                                <Label Text="Jours restants" Style="{StaticResource TableHeader}" Grid.Column="4"/>
                                <Label Text="Statut" Style="{StaticResource TableHeader}" Grid.Column="5"/>
                                <Label Text="Retard" Style="{StaticResource TableHeader}" Grid.Column="6"/>
                                <Label Text="Actions" Style="{StaticResource TableHeader}" Grid.Column="7" HorizontalTextAlignment="Center"/>
                            </Grid>
                        </Border>

                        <!-- Liste -->
                        <CollectionView Grid.Row="1"
                                ItemsSource="{Binding Emprunts}"
                                SelectionMode="Single"
                                EmptyView="Aucun emprunt trouvÃ©">

                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Border Style="{StaticResource TabContent}">
                                        <Grid ColumnDefinitions="1.5*,1.2*,1*,1*,1*,1*,0.8*,1*" 
                                      Padding="15,12"
                                      ColumnSpacing="10">

                                            <!-- Colonne Livre & AdhÃ©rent -->
                                            <StackLayout Grid.Column="0" Spacing="4">
                                                <Label Text="{Binding TitreLivre}" Style="{StaticResource TableRowData}"/>
                                                <Label Text="{Binding NomAdherent}" Style="{StaticResource TableRowData}"/>
                                            </StackLayout>

                                            <!-- ISBN -->
                                            <Label Grid.Column="1" Text="{Binding ISBN}" Style="{StaticResource TableRowData}"/>

                                            <!-- Date Emprunt -->
                                            <Label Grid.Column="2" 
                                           Text="{Binding DateEmprunt, StringFormat='{0:dd/MM/yy}'}" Style="{StaticResource TableRowData}"/>

                                            <!-- Date Retour -->
                                            <Label Grid.Column="3" 
                                           Text="{Binding DateRetourPrevue, StringFormat='{0:dd/MM/yy}'}" Style="{StaticResource TableRowData}"/>

                                            <!-- Jours restants -->
                                            <Label Grid.Column="4" Text="{Binding JoursRestants}" Style="{StaticResource TableRowData}" HorizontalTextAlignment="Center"/>

                                            <!-- Statut -->
                                            <Border Grid.Column="5">
                                                <Label Text="{Binding Statut}" Style="{StaticResource TableRowData}" HorizontalOptions="Center"/>
                                            </Border>

                                            <!-- Retard -->
                                            <Label Grid.Column="6" 
                                           Text="{Binding JoursRetard}" Style="{StaticResource TableRowData}" HorizontalTextAlignment="Center"/>

                                            <!-- Actions -->
                                            <StackLayout Grid.Column="7" 
                                                 Orientation="Horizontal" 
                                                 Spacing="5"
                                                 HorizontalOptions="Center">

                                                <Button Text="ğŸ‘ï¸"
                                                BackgroundColor="#3B82F6"
                                                TextColor="White"
                                                FontSize="10"
                                                CornerRadius="6"
                                                WidthRequest="30"
                                                HeightRequest="30"/>

                                                <Button Text="ğŸ“§"
                                                BackgroundColor="#8B5CF6"
                                                TextColor="White"
                                                FontSize="10"
                                                CornerRadius="6"
                                                WidthRequest="30"
                                                HeightRequest="30"/>

                                                <Button Text="ğŸ”„"
                                                BackgroundColor="#10B981"
                                                TextColor="White"
                                                FontSize="10"
                                                CornerRadius="6"
                                                WidthRequest="30"
                                                HeightRequest="30"/>
                                            </StackLayout>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </Grid>
                </Border>
            </Grid>
        </ScrollView>
    </Grid>
</ContentPage>