<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="BibliothequeManager.Pages.Views.CategoriePage"
                xmlns:localApp="clr-namespace:BibliothequeManager"
             Title="CatÃ©gories"
             NavigationPage.HasNavigationBar="False">

    <Grid>
        <!-- Fond -->
        <Image Source="new_background.png"
               Aspect="AspectFill"
               InputTransparent="True"
               Opacity="0.2" />

        <ScrollView>
            <Grid RowDefinitions="Auto,Auto,*">
                <!-- ========== EN-TÃŠTE ========== -->
                <Grid Style="{StaticResource StackLayoutAcc}">
                    <StackLayout Orientation="Horizontal" HorizontalOptions="Center" Spacing="100">
                        <!-- Logo Ã  gauche -->
                        <Border Style="{StaticResource RoundedImageBorder}">
                            <Image Source="logo.png" Style="{StaticResource Logo}" />
                        </Border>

                        <StackLayout Style="{StaticResource StackLayoutAcce}">
                            <Label Text="{Binding [CategoryManagement], Source={x:Static localApp:App.Localized}}"
                               Style="{StaticResource HeaderLabel}" />
                            <Label Text="{Binding [OrganizeCategory], Source={x:Static localApp:App.Localized}}"
                               Style="{StaticResource SubHeaderLabel}" />
                        </StackLayout>
                    </StackLayout>
                </Grid>

                <!-- Recherche -->
                <HorizontalStackLayout Grid.Row="1" Style="{StaticResource RechercherZone}">
                    <Border Stroke="{StaticResource PrimaryBlue}"
                            StrokeThickness="1"
                            StrokeShape="RoundRectangle 24"
                            BackgroundColor="White"
                            HeightRequest="50"
                            WidthRequest="600"
                            HorizontalOptions="Center">
                        <Grid ColumnDefinitions="*,Auto">
                            <Entry x:Name="SearchEntry"
                                   Placeholder="{Binding [Category2], Source={x:Static localApp:App.Localized}}"
                                   Style="{StaticResource TextZone}" />
                            <Button x:Name="SearchButton"
                                    Style="{StaticResource SearchIconButton}">
                                <Button.ImageSource>
                                    <FontImageSource FontFamily="MaterialIcons"
                                                     Glyph="&#xe8b6;"
                                                     Color="White"
                                                     Size="22" />
                                </Button.ImageSource>
                            </Button>
                        </Grid>
                    </Border>
                </HorizontalStackLayout>

                <!-- ========== LISTE DES CATÃ‰GORIES ========== -->
                <CollectionView x:Name="CategoriesCollectionView"
                                Grid.Row="2"
                                SelectionMode="Single"
                                Margin="50,0">
                    <CollectionView.ItemsLayout>
                        <GridItemsLayout 
                            Orientation="Vertical"
                            Span="{OnIdiom Phone=2, Tablet=4, Desktop=6, Default=3}"
                            VerticalItemSpacing="10"/>
                    </CollectionView.ItemsLayout>

                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Border Style="{StaticResource AuthorCard}">
                                <Grid RowDefinitions="Auto,Auto,Auto" 
                                      RowSpacing="8"
                                      Padding="15">
                                    <!-- IcÃ´ne -->
                                    <Label Grid.Row="0"
                                           Text="ðŸ“š"
                                           FontSize="32"
                                           HorizontalOptions="Center" />
                                    <!-- Nom -->
                                    <Label Grid.Row="1"
                                           Text="{Binding Nom}"
                                           Style="{StaticResource AuthorNom}" />
                                    <!-- Nombre de livres -->
                                    <Border Grid.Row="2"
                                            Style="{StaticResource BookCountBadge}">
                                        <Label Text="{Binding NombreLivres, StringFormat='{0} livre(s)'}"
                                               Style="{StaticResource BookCountText}"/>
                                    </Border>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </Grid>
        </ScrollView>

        <!-- ========== FORMULAIRE  ========== -->
        <Border x:Name="FormulaireCategorie"
                IsVisible="False"
                Style="{StaticResource FormulaireAuteur}" 
                Padding="20">
            <VerticalStackLayout Spacing="15">
                <!-- Titre du formulaire -->
                <Label x:Name="FormTitle"
                       Text="{Binding [AddCategories], Source={x:Static localApp:App.Localized}}"
                       Style="{StaticResource FormulaireTitle}" />

                <!-- Champs -->
                <Grid RowDefinitions="*,*" RowSpacing="50">
                    <VerticalStackLayout Spacing="5" >
                        <Label x:Name="NomFormLabel" Grid.Row="0"
                               Text="{Binding [NameRequired], Source={x:Static localApp:App.Localized}}"
                               Style="{StaticResource FormLabel}" />
                        <Entry x:Name="NomCategorieEntry"
                               Placeholder="{Binding [NameRequired], Source={x:Static localApp:App.Localized}}"
                               Style="{StaticResource FormEntry}" />
                    </VerticalStackLayout>
                    <VerticalStackLayout Spacing="5" Grid.Row="1">
                        <Label x:Name="DescriptionFormLabel"
                               Text="{Binding [DescriptionOptional], Source={x:Static localApp:App.Localized}}"
                               Style="{StaticResource FormLabel}" />
                        <Entry x:Name="DescriptionCategorieEntry"
                               Placeholder="{Binding [DescriptionOptional], Source={x:Static localApp:App.Localized}}"
                               Style="{StaticResource FormEntry}" />
                    </VerticalStackLayout>
                </Grid>
                
                <!-- Boutons -->
                <HorizontalStackLayout HorizontalOptions="Center" Spacing="12" Padding="0,20">
                    <Button x:Name="AjouterButton"
                            Text="{Binding [Add], Source={x:Static localApp:App.Localized}}"
                            Style="{StaticResource PrimaryButton}"
                            Clicked="OnAjouterCategorieClicked">
                        <Button.ImageSource>
                            <FontImageSource 
                                FontFamily="MaterialIcons"
                                Glyph="&#xe145;"  
                                Color="White"
                                Size="18" />
                        </Button.ImageSource>
                    </Button>

                    <Button x:Name="ModifierButton"
                            Text="{Binding [Edit], Source={x:Static localApp:App.Localized}}"
                            Style="{StaticResource WarningButton}"
                            Clicked="OnModifierCategorieClicked"
                            IsVisible="False">
                        <Button.ImageSource>
                            <FontImageSource 
                            FontFamily="MaterialIcons"
                            Glyph="&#xe3c9;"    
                            Color="White"
                            Size="18" />
                        </Button.ImageSource>
                    </Button>

                    <Button x:Name="SupprimerButton"
                            Text="{Binding [delete], Source={x:Static localApp:App.Localized}}"
                            Style="{StaticResource DangerButton}"
                            Clicked="OnSupprimerCategorieClicked"
                            IsVisible="False">
                        <Button.ImageSource>
                            <FontImageSource 
                                FontFamily="MaterialIcons"
                                Glyph="&#xe872;"   
                                Color="White"
                                Size="18" />
                        </Button.ImageSource>
                    </Button>
                </HorizontalStackLayout>
            </VerticalStackLayout>
        </Border>

        <!-- Bouton flottant "+" (toujours visible, en bas Ã  droite) -->
        <Button Text="+"
                Clicked="OnFloatingAddCategorieClicked"
                Style="{StaticResource FloatingAddButton}"
                HorizontalOptions="End"
                VerticalOptions="End"
                Margin="0,0,20,20" />
    </Grid>
</ContentPage>